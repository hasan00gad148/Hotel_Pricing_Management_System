# Hotel Pricing Management System

An educational Django REST Framework project demonstrating a hotel room pricing workflow with analytics, recommendations, and automated write-backs.

---

## Overview

This system simulates a hotel pricing workflow:

1. Generates price recommendations for hotel rooms (via analytical models or data pipelines).
2. Displays recommendations to managers for review.
3. Allows managers to **accept**, **amend**, or **reject** prices.
4. Automatically **writes back confirmed prices** (accepted or amended) to the external system at the end of each day.

---

## Features

### Core
- Manage rooms, bookings, and price recommendations.
- Review and confirm recommendations with one of four statuses:
  - **Accepted**
  - **Amended**
  - **Rejected**
  - **Pending**
- Automatic write-back for confirmed prices (via scheduled Django command).

### API
- RESTful endpoints built with Django REST Framework.
- Authentication and role-based access (pricing managers vs. reporting users).
- Pagination and filtering by building, room type, bed count, and arrival date.

### Data Integration
- Designed to integrate with PySpark for large-scale price and booking data.
- Supports reading from CSVs or Spark DataFrames.
- Write-back command can be run manually or scheduled via cron.

---

## Tech Stack

| Layer | Technology |
|-------|-------------|
| **Framework** | Django 4.2 + Django REST Framework |
| **Database** | PostgreSQL |
| **Data Processing** | PySpark, Pandas |
| **Language** | Python 3.9+ |

---

## ðŸš€ Data Preparation Workflow

Before running the Django backend, you must first generate and process the data.  
The pipeline follows three main steps:

### 1. Generate Example Data

This creates example CSV files (`products.csv`, `bookings.csv`, `buildings.csv`, and `prices.csv`) in the `ETL/Data` directory.

```bash
python pricing/ETL/Data/GenData.py
```

**Output:**  
CSV files stored in `pricing/ETL/Data/`.

---

### 2. Ingest Data into Database (via PySpark)

This step loads the generated CSVs into the PostgreSQL database.

```bash
python pricing/ETL/pyspark_ingest.py
```

**Purpose:**  
- Reads the generated CSVs.  
- Creates the database tables (`products`, `prices`, `bookings`, etc.).  
- Writes them into the configured PostgreSQL instance.

---

### 3. Run Clustering & Price Recommendation

This performs data analysis and generates recommended prices.

```bash
python pricing/ETL/pyspark_clustering.py
```

**Purpose:**  
- Reads from the database tables.  
- Applies clustering or analytical logic to determine recommended prices.  
- Writes results into the `price_recommendations` table (used by the Django API).

---

### âœ… After the ETL Pipeline

Once the three scripts have been executed successfully:

1. Your PostgreSQL database will be populated with all required tables.  
2. You can then launch the Django backend using:

```bash
python manage.py runserver
```

3. The `/api/recommendations/` endpoint will return live recommendations generated by your Spark pipeline.

---

## Project Structure

```
hotel_pricing/
â”œâ”€â”€ manage.py
â”œâ”€â”€ pricing/
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ views.py
â”‚   â”œâ”€â”€ serializers.py
â”‚   â”œâ”€â”€ permissions.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â”œâ”€â”€ management/
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚       â””â”€â”€ writeback_confirmed_prices.py
â”‚   â”œâ”€â”€ ETL/
â”‚   â”‚   â”œâ”€â”€ Data/
â”‚   â”‚   â”‚   â”œâ”€â”€ bookings.csv
â”‚   â”‚   â”‚   â”œâ”€â”€ buildings.csv
â”‚   â”‚   â”‚   â”œâ”€â”€ prices.csv
â”‚   â”‚   â”‚   â”œâ”€â”€ products.csv
â”‚   â”‚   â”‚   â””â”€â”€ GenData.py
â”‚   â”‚   â”œâ”€â”€ pyspark_ingest.py
â”‚   â”‚   â””â”€â”€ pyspark_clustering.py
â”‚   â””â”€â”€ generate_mock_data.py
â””â”€â”€ req.txt
```

---

## Installation & Setup

### 1. Clone Repository
```bash
git clone <repo-url>
cd hotel_pricing
```

### 2. Create Virtual Environment
```bash
python -m venv venv
source venv/bin/activate      # Linux / macOS
venv\Scripts\activate         # Windows
```

### 3. Install Dependencies
```bash
pip install -r req.txt
```

### 4. Run Migrations and Create Users
```bash
python manage.py migrate
python manage.py createsuperuser
python generate_mock_data.py   # optional demo data
```

### 5. Start the Server
```bash
python manage.py runserver
```

---

## API Endpoints

| Endpoint | Method | Description | Auth Required |
|-----------|--------|--------------|----------------|
| `/api/filters/` | GET | Get available filters | âœ… |
| `/api/recommendations/` | GET | List price recommendations | âœ… |
| `/api/batch_confirm/` | POST | Submit accepted/amended recommendations | âœ… |
| `/admin/` | Web | Django admin interface | âœ… |

---

## Write-Back Command

The following command writes back confirmed (accepted or amended) prices to the external system and marks them as written:

```bash
python manage.py writeback_confirmed_prices
```

This can be run manually or scheduled daily using cron.

---

## User Roles

| Role | Permissions |
|------|--------------|
| **Pricing Manager** | View and confirm recommendations (accept/amend/reject). |
| **Reporting User** | Read-only access to recommendations. |

---

## Example Workflow

1. Run the ETL pipeline (GenData â†’ Ingest â†’ Cluster).  
2. A pricing manager logs in and reviews recommended prices.  
3. They approve or amend recommendations using the `/api/batch_confirm/` endpoint.  
4. At the end of the day, the `writeback_confirmed_prices` command exports confirmed prices to the target system.


